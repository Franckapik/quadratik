<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Boutique Quadratik.fr</title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://www.paypalobjects.com/api/checkout.js"></script>
  <script src="https://checkout.stripe.com/checkout.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zooming/1.2.7/zooming.js"></script>
  <script type="text/javascript" src="js/paypal.js"></script>
    <script type="text/javascript" src="js/stripe.js"></script>
</head>

<body id="body_shop">


  <% include header.ejs %>

    <div class="shop_container">


      <div id="app">
        <div class="cart_box">

<%= variable %>

          <!-- PANIER-->

          <button @click="showCart = !showCart" v-show="!verified" id="cart_button">
      <i class="fa fa-shopping-cart fa-2x" aria-hidden="true"></i> {{ items.length  }}
    </button>



          <div class="cart" v-show="showCart">
            <div v-show="items.length > 0">
              <ul>
                <li v-for="item in items" transition="fade">
                  <p><strong>{{ item.quantity }}</strong> - {{ item.name }} <i class="fa fa-trash" @click="removeFromCart(item)"></i></p>
                </li>
              </ul>
              <div><button @click="verified = true, showCart = false" id="order_button">Passer la commande</button></div>
            </div>
            <div v-show="items.length === 0">
              <p>Votre panier est vide!</p>
            </div>
          </div>
        </div>
        <h2>Boutique</h2>
        <!--  LISTE ARTICLES -->
        <div class="container">
          <div class="shop" v-show="!verified">
            <div class="collection">
              <h3>Simple et efficace : Klassik-7</h3>
              <ul class="flex_row">
                <li v-for="item in shop[0]">
                  <div class="article_box">
                    <h5>{{ item.name }}</h5>
                    <p>{{ item.price }} €</p>
                    <img src="{{ item.img }}" alt="Affichage non disponible" data-action="zoom">
                    <button @click="addToCart(item)">Ajouter au panier</button>
                    <!-- TO DO : view details-->
                  </div>
                </li>
              </ul>
            </div>
<div class="collection">
  <h3>Collection Organik</h3>
  <hr>
  <ul class="flex_row">
    <li v-for="item in shop[1]">
      <div class="article_box">
        <h5>{{ item.name }}</h5>
        <p>{{ item.price }} €</p>
        <img src="{{ item.img }}" alt="Affichage non disponible" data-action="zoom">
        <button @click="addToCart(item)">Ajouter au panier</button>
        <!-- TO DO : view details-->
      </div>
    </li>
  </ul>
</div>

            <div class="collection">
              <h3>Collection Botanik</h3>
              <ul class="flex_row">
                <li v-for="item in shop[2]">
                  <div class="article_box">
                    <h5>{{ item.name }}</h5>
                    <p>{{ item.price }} €</p>
                    <img src="{{ item.img }}" alt="Affichage non disponible" data-action="zoom">
                    <button @click="addToCart(item)">Ajouter au panier</button>
                    <!-- TO DO : view details-->
                  </div>
                </li>
              </ul>
            </div>
          <div class="collection">
            <h3>Collection Minimalik</h3>
            <ul class="flex_row">
              <li v-for="item in shop[3]">
                <div class="article_box">
                  <h5>{{ item.name }}</h5>
                  <p>{{ item.price }} €</p>
                  <img src="{{ item.img }}" alt="Affichage non disponible" data-action="zoom">
                  <button @click="addToCart(item)">Ajouter au panier</button>
                  <!-- TO DO : view details-->
                </div>
              </li>
            </ul>
          </div>
          <div class="collection">
            <h3>Collection Gamik</h3>
            <ul class="flex_row">
              <li v-for="item in shop[4]">
              <div class="article_box">
                  <h5>{{ item.name }}</h5>
                  <p>{{ item.price }} €</p>
                  <img src="{{ item.img }}" alt="Affichage non disponible" data-action="zoom">
                  <button @click="addToCart(item)">Ajouter au panier</button>
                  <!-- TO DO : view details-->
                </div>
              </li>
            </ul>
          </div>

          </div>

          <!-- CHECKOUT -->
          <div class="checkout" v-show="verified">
            <h3>Votre Panier</h3>
            <h5 v-for="item in items"><strong>{{ item.quantity }}</strong> - {{ item.name }}<span>    | {{ item.price * item.quantity }} €</span></h5>
            <hr />
            <div class="row">
              <div class="u-pull-right">
                <h5>Total: <span>{{ total  }} €</span></h5>
                <p></p>



                <div class="payment_solutions flex_row">
                  <!--Stripe-->
                <button id="buttonCheckout">Carte bancaire</button>

                  <!--Paypal-->
                  <a href="/buy"><button class="btn btn-warning btn-lg"> PayPal </button></a>

                  <!--Chèque-->
                  <button type="button" name="button_cheque" id="button_cheque"> Chèque Bancaire </button>

                </div>
                <p></p>
                <p></p>
                <a href="/shop">Retour en boutique</a>

              </div>

            </div>
          </div>
        </div>





      </div>
    </div>
</body>
<script src="/socket.io/socket.io.js"></script>

<script type="text/javascript" src="js/articles.js"></script>
<script type="text/javascript">

var checkoutHandler = StripeCheckout.configure({
  key: "pk_test_oaiyISu3eJI542wOXmZ0ePd4",
  locale: "fr"
});

var button = document.getElementById("buttonCheckout");
button.addEventListener("click", function(ev) {
  checkoutHandler.open({
    name: "Sample Store",
    description: "Example Purchase",
    token: handleToken
  });
});

function handleToken(token) {
  fetch("/charge", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(token)
    })
    .then(response => {
      if (!response.ok)
        throw response;
      return response.json();
    })
    .then(output => {
      console.log("Purchase succeeded:", output);
    })
    .catch(err => {
      console.log("Purchase failed:", err);
    })

}


</script>


</html>
